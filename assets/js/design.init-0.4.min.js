if(window.location.href.indexOf("http://devblogg2.zida.se/")!=0){window.location.href="http://blogg.zida.se/"}var global_key=new Array();$(document).keyup(function(a){code=a.keyCode?a.keyCode:a.which;global_key[code]=false}).keydown(function(a){code=a.keyCode?a.keyCode:a.which;global_key[code]=true});var select={tool:{frame:"#tool",components:".tool-component",dock:"#tool-dock a",draghandlers:".draghandler",layers:".layer"},component:{frames:".component",id:function(a){return this.frames+"[layer_id='"+a+"']"}},canvas:{inner:"#workspace",outer:"#worksheet"},blog:window.location.pathname.substr("/design/edit/".length).split("/")[0],layout:window.location.pathname.substr("/design/edit/".length).split("/")[1]};var components={blog_posts:{css:{"background-color":"#ffffff",color:"#000000",height:200,width:200},text:"Blogg inlägg",description:"Här kommer blogg inläggen att visas."},list:{css:{"background-color":"#000000",color:"#ffffff",height:100,width:100},text:"Lista",description:"En lista med länkar."},image:{css:{"background-color":"#fa615c",color:"#ffffff",height:100,width:100},text:"Bild",description:"Denna kan användas som symboler, bakgrund, dekorationer, vanlig bild."},text:{css:{"background-color":"#b3e6cf",color:"#000000",height:100,width:100},text:"Text",description:"Enbart text."},grid:{css:{"background-color":"#cccccc",color:"#000000",height:300,width:200},text:"Låda",description:"Du kan lägga in andra verktyg in till lådan så det blir lättare att tex ändra storleken på flera objekt samtidigt."}};var event_maker={events:{click:"klick",dblclick:"dubbelklick",mouseover:"musen över",mouseout:"musen ut"},effects:{hide:"göm",show:"visa"},duration:{0:"instant",1000:"snabbt",2000:"söligt"}};var global_settings={view_content:true,component_zIndex:500,inner_background:"http://",outer_background:"http://"};var tool_settings={dock:false,component:{height:100,width:100}};var handle_settings={tool:{draggable:{cancel:select.tool.components+", input",containment:select.canvas.outer,handle:select.tool.draghandlers+", #tool-dock",snap:select.canvas.inner,snapMode:"outer",snapTolerance:10,start:function(a){$(this).data("started",true)},stop:function(a){$(this).data("started",false)}},draghandler:{toggle:function(){var a=$(this).next();if(!$(select.tool.frame).data("started")){a.toggle()}if(a.is(":hidden")){$(this).addClass("hidden")}else{$(this).removeClass("hidden")}}}},component:{resizable:{handles:"all",resize:function(){if($(this).data("component_type")=="grid"){$(select.component.frames,this).width($(this).width())}}},mark:function(){var b=$(select.component.id($(this).data("layer_id"))),a=$(select.canvas.inner);show_focus_frame(b,a)},unmark:function(){var b=$(select.component.id($(this).data("layer_id"))),a=$(select.canvas.inner);hide_focus_frame(b,a)}}};var tool={move:{fixed:function(){$(select.tool.frame).draggable("destroy");tool_settings.dock=true;$(window).trigger("resize")},free:function(){$(select.tool.frame).draggable(handle_settings.tool.draggable).disableSelection();tool_settings.dock=false;$(window).trigger("resize")}}};$(document).ready(function(){function a(){$(select.tool.dock).toggle(tool.move.fixed,tool.move.free);$(select.tool.draghandlers).mouseup(handle_settings.tool.draghandler.toggle);tool.move.free()}$(select.tool.layers).live("mouseover",handle_settings.component.mark);$(select.tool.layers).live("mouseout",handle_settings.component.unmark);$(select.tool.layers).live("click",function(){$(select.component.id($(this).data("layer_id"))).click()});$(select.tool.layers).live("dblclick",function(){var b=prompt("Byt lager namn",$(this).text().substr(1));if(b!=null&&b!=""){$(this).html("<a>X</a>"+b)}});$(".layer a").live("click",function(){$(this).mouseout();$("#workspace .component[layer_id='"+$(this).parent().data("layer_id")+"']").remove();$(this).parent().remove()});$("#tool-section-layer .tool-section-content").sortable({placeholder:"ui-state-highlight",update:function(){var b=500+$(".layer").length;$(".layer").each(function(c){var d=$(".component[layer_id='"+$(this).data("layer_id")+"']");d.css("z-index",--b)})}});$(".component a").live("click",function(b){b.preventDefault()});$(".component").live("click",function(){var h=$(this),i=$(this).data("component_type"),l=$(".layer[layer_id='"+$(this).attr("layer_id")+"']");$("#tool-section-select").data("selected",$(this).attr("layer_id"));$("#tool-section-select").data("component_type",$(this).data("component_type"));if(global_key[16]==undefined){global_key[16]=false}if(global_key[17]==undefined){global_key[17]=false}if(global_key[17]==false&&global_key[16]==false){$(".layer").removeClass("selected")}if(global_key[16]==true&&$(".layer.selected").length>0){var b=l.parent().children().index(l.get(0));var j=l.parent().children().index($(".layer.selected").get(0));$(".layer").each(function(m){if(b<j){if(m>b&&m<j){$(this).addClass("selected")}}else{if(m<b&&m>j){$(this).addClass("selected")}}})}if(global_key[17]==true&&l.hasClass("selected")){l.removeClass("selected")}else{l.addClass("selected")}var d=l.text().substr(1);var k="";k+="<p>Background Text</p>";k+="<span class='input-color-box' style='background-color:"+$(this).data("css")["background-color"]+";'></span><input type='text' id='background-color' class='input-color color {hash:true}' name='color' value='"+$(this).data("css")["background-color"]+"' />";k+="<span class='input-color-box' style='background-color:"+$(this).data("css").color+";'></span><input type='text' id='text-color' class='input-color color {hash:true}' name='color' value='"+$(this).data("css").color+"' />";if(i!="image"&&i!="grid"){k+="<p>Text storlek</p>";var e=($(this).data("css")["font-size"])?$(this).data("css")["font-size"].substr():"12px";e=e.substr(0,e.length-2);k+="<input type='text' id='text-size' class='input-number' value='"+e+"' /> px"}k+="<br/><a id='background-transparent'>Transparent</a><br/>";if($(".layer.selected").length==1){k+="<a id='settings-events'>Händelser</a><br/>";if(i=="grid"){var g=$(this).data("grid-margin");if(g==undefined){g=0}k+='<label for="grid-margin">Marginal:</label><input class="input-number" type="text" id="grid-margin" name="grid-margin" value="'+g+'" />'}}$("#tool-section-select .tool-section-content").html("");$(k).appendTo("#tool-section-select .tool-section-content");function c(m,o,n){$("#background-color").val("#"+o);$("#background-color").prev().css("background-color","#"+o);$(".layer.selected").each(function(p){var r=$(this).data("layer_id");var q=$(select.component.id(r)).data("css");q["background-color"]=$("#background-color").val();$(select.component.id(r)).data("css",q);$(select.component.id(r)).css("background-color",$("#background-color").val())})}$("#background-color").ColorPicker({onChange:c,onSubmit:c}).ColorPickerSetColor($(this).data("css")["background-color"]).bind("keyup",function(){$(this).ColorPickerSetColor($(this).val())});function f(m,o,n){$("#text-color").val("#"+o);$("#text-color").prev().css("background-color","#"+o);$(".layer.selected").each(function(p){var r=$(this).data("layer_id");var q=$(select.component.id(r)).data("css");q.color=$("#text-color").val();$(select.component.id(r)).data("css",q);$(select.component.id(r)).css("color",$("#text-color").val())})}$("#text-color").ColorPicker({onChange:f,onSubmit:f}).ColorPickerSetColor($(this).data("css").color).bind("keyup",function(){$(this).ColorPickerSetColor($(this).val())})});$(".input-color-box").live("click",function(){$(this).next().click()});$("#text-size").live("blur",function(){var b=$(this);$(".layer.selected").each(function(d){var e=$(this).data("layer_id");$(select.component.id(e)).css("font-size",b.val()+"px");var c=$(select.component.id(e)).data("css");c["font-size"]=b.val()+"px";$(select.component.id(e)).data("css",c)})});$("#background-transparent").live("click",function(){$(".layer.selected").each(function(c){var d=$(this).data("layer_id");$(select.component.id(d)).css("background-color",null);var b=$(select.component.id(d)).data("css");b["background-color"]="";$(select.component.id(d)).data("css",b)})});$("#grid-margin").live("keyup",function(){var d=$(".layer.selected").data("layer_id");var c=$(select.component.id(d));var b=c.data("grid-margin");if(b==undefined){b=0}c.css({padding:$(this).val()}).data("grid-margin",$(this).val()).height(c.height()-($(this).val()-b)*2).width(c.width()-($(this).val()-b)*2);$(select.component.frames,c).width(c.width())});$("#settings-events").live("click",function(){$("#dialog-settings-events").dialog({autoOpen:false,modal:true,width:600,open:function(){var b=$(this);$("#events-event").html("");$.each(event_maker.events,function(e,f){$("<option value='"+e+"'>"+f+"</option>").appendTo("#events-event")});$("#events-effect").html("");$.each(event_maker.effects,function(e,f){$("<option value='"+e+"'>"+f+"</option>").appendTo("#events-effect")});$("#events-duration").html("");$.each(event_maker.duration,function(e,f){$("<option value='"+e+"'>"+f+"</option>").appendTo("#events-duration")});$("#events-layer").html("");$(".layer").each(function(e){$("<option value='"+$(this).data("layer_id")+"'>"+$(this).text().substr(1)+"</option>").appendTo("#events-layer")});$(this).find("tbody").html("");var d=$(".layer.selected").data("layer_id");var c=$(select.component.id(d)).data("user_events");if(c){$.each(c,function(g,k){var i=k.event;var h=k.effect;var j=k.duration;var f=k.layer;if($(".layer[layer_id='"+f+"']").length==0){return true}var e="";e+='<tr><td>Vid <select class="events-event">';$.each(event_maker.events,function(l,m){if(l==i){e+="<option value='"+l+"' selected>"+m+"</option>"}else{e+="<option value='"+l+"'>"+m+"</option>"}});e+='</select></td><td><select class="events-effect">';$.each(event_maker.effects,function(l,m){if(l==h){e+="<option value='"+l+"' selected>"+m+"</option>"}else{e+="<option value='"+l+"'>"+m+"</option>"}});e+='</select></td><td><select class="events-duration">';$.each(event_maker.duration,function(l,m){if(l==j){e+="<option value='"+l+"' selected>"+m+"</option>"}else{e+="<option value='"+l+"'>"+m+"</option>"}});e+='</select></td><td><select class="events-layer">';$(".layer").each(function(l){if($(this).data("layer_id")==f){e+="<option value='"+$(this).data("layer_id")+"' selected>"+$(this).text().substr(1)+"</option>"}else{e+="<option value='"+$(this).data("layer_id")+"'>"+$(this).text().substr(1)+"</option>"}});e+='</select></td><td><a class="delete">Ta bort</a></td></tr>';$("tbody",b.get(0)).append(e)})}},buttons:{Avbryt:function(){$(this).dialog("close");$(this).dialog("destroy")},"Ändra":function(){var b={};$(this).find("tbody").find("tr").each(function(d){var e={event:$(this).find(".events-event").val(),effect:$(this).find(".events-effect").val(),duration:$(this).find(".events-duration").val(),layer:$(this).find(".events-layer").val()};b[d]=e});var c=$(".layer.selected").data("layer_id");$(select.component.id(c)).data("user_events",b);$(this).dialog("close");$(this).dialog("destroy")}},close:function(){}});$("#dialog-settings-events").dialog("open")});$(".component").live("dblclick",function(){var d=$(this).attr("layer_id");var b=$(this).data("component_type");var c=$(this);if("text"==$(this).data("component_type")){$("#dialog-component-text").dialog({autoOpen:false,modal:true,open:function(){c.resizable("destroy");$(this).find("textarea").val(c.text())},buttons:{Avbryt:function(){$(this).dialog("close")},"Ändra":function(){c.text($(this).find("textarea").val());$(this).dialog("close")}},close:function(){c.resizable(handle_settings.component.resizable);$(this).find("textarea").val("")}});$("#dialog-component-text").dialog("open")}if("image"==$(this).data("component_type")){$("#dialog-component-image").dialog({autoOpen:false,modal:true,open:function(){$(this).find("input[name=url]").val(c.find("img").attr("src"))},buttons:{Avbryt:function(){$(this).dialog("close");$(this).dialog("destroy")},"Ändra":function(){var e=$("<img/>");e.load(function(){c.width(this.width);c.height(this.height);$(this).data("width",this.width);$(this).data("height",this.height);$(this).css({width:"100%",height:"100%"})}).attr("src","http://"+$(this).find("input[name=url]").val().replace("http://",""));c.resizable("destroy").html(e).resizable(handle_settings.component.resizable);$(this).dialog("close");$(this).dialog("destroy")}},close:function(){$(this).find("input[name=url]").val("http://")}});$("#dialog-component-image").dialog("open")}if("list"==$(this).data("component_type")){$("#dialog-component-list").dialog({autoOpen:false,modal:true,width:300,open:function(){$(this).find("tbody").html("");c.find("li").each(function(e){$("#dialog-component-list tfoot a").click();$("#dialog-component-list tbody tr:last").find("td:first input").val($(this).find("a").attr("href"));$("#dialog-component-list tbody tr:last").find("td:last input").val($(this).text())})},buttons:{Avbryt:function(){$(this).dialog("close");$(this).dialog("destroy")},"Ändra":function(){var e="<ul>";$(this).find("tbody").find("tr").each(function(f,g){e+="<li><a href='"+$(this).find("td:first input").val()+"'>"+$(this).find("td:last input").val()+"</a></li>"});e+="</ul>";c.find("ul").sortable("destroy");c.resizable("destroy").html(e).resizable(handle_settings.component.resizable);c.find("ul").sortable({connectWith:".component ul",placeholder:"ui-state-highlight"});$(this).dialog("close");$(this).dialog("destroy")}},close:function(){}});$("#dialog-component-list").dialog("open")}});$("#dialog-component-list").find("tfoot a").click(function(){$('<tr><td><input type="text" id="url" name="url" value="http://" /></td><td><input type="text" id="namn" name="namn" value="" /></td></tr>').appendTo("#dialog-component-list tbody")});$("#dialog-settings-events").find("tfoot a").click(function(){var e=$("#dialog-settings-events").find("#events-event").val();var d=$("#dialog-settings-events").find("#events-effect").val();var f=$("#dialog-settings-events").find("#events-duration").val();var c=$("#dialog-settings-events").find("#events-layer").val();var b="";b+='<tr><td>Vid <select class="events-event">';$.each(event_maker.events,function(g,h){if(g==e){b+="<option value='"+g+"' selected>"+h+"</option>"}else{b+="<option value='"+g+"'>"+h+"</option>"}});b+='</select></td><td><select class="events-effect">';$.each(event_maker.effects,function(g,h){if(g==d){b+="<option value='"+g+"' selected>"+h+"</option>"}else{b+="<option value='"+g+"'>"+h+"</option>"}});b+='</select></td><td><select class="events-duration">';$.each(event_maker.duration,function(g,h){if(g==f){b+="<option value='"+g+"' selected>"+h+"</option>"}else{b+="<option value='"+g+"'>"+h+"</option>"}});b+='</select></td><td><select class="events-layer">';$(".layer").each(function(g){if($(this).data("layer_id")==c){b+="<option value='"+$(this).data("layer_id")+"' selected>"+$(this).text().substr(1)+"</option>"}else{b+="<option value='"+$(this).data("layer_id")+"'>"+$(this).text().substr(1)+"</option>"}});b+='</select></td><td><a class="delete">Ta bort</a></td></tr>';$(b).appendTo("#dialog-settings-events tbody")});$("#dialog-settings-events").find("tbody a").live("click",function(){$(this).parent().parent().remove()});$("#worksheet").disableSelection();$(document).keydown(function(c){var b=c.target.nodeName;if(b=="INPUT"||b=="SELECT"||b=="TEXTAREA"){return true}var e=0,d=0;if(c.keyCode==37){d--}else{if(c.keyCode==39){d++}}if(c.keyCode==38){e--}else{if(c.keyCode==40){e++}}$(".layer.selected").each(function(f){var g=$(this).data("layer_id");$(select.component.id(g)).css({left:function(h,i){return parseInt(i.replace("px",""))+d},top:function(h,i){return parseInt(i.replace("px",""))+e}})});return true});$("#worksheet").mousedown(function(b){if(global_key[32]){b.preventDefault()}});$("#workspace").droppable({accept:".tool-component, .component",drop:function(d,e){var c=e.draggable;if(jQuery.data(c.get(0),"grid")){c.data("grid",false).css({position:"absolute",minHeight:"none",left:d.pageX-$("#workspace").offset().left-tool_settings.component.width/2,top:d.pageY-$("#workspace").offset().top-tool_settings.component.height/2}).resizable(handle_settings.component.resizable);$(this).append(c);return}if(!jQuery.data(c.get(0),"tool")){return}var b=jQuery.data(c.get(0),"component_type");add_component(b,false,d)},greedy:true});$("#workspace").mousedown(function(b){if(b.target===b.currentTarget){$(this).data("mousedown",true);b.preventDefault()}});$("#workspace").mousemove(function(b){if($(this).data("mousedown")){if($(this).data("prev_mouse_cords")){currTop=$("#worksheet").scrollTop();currLeft=$("#worksheet").scrollLeft();prev_pos=$(this).data("prev_mouse_cords");$("#worksheet").scrollTop(currTop-(b.pageY-prev_pos.y));$("#worksheet").scrollLeft(currLeft-(b.pageX-prev_pos.x))}$(this).data("prev_mouse_cords",{x:b.pageX,y:b.pageY})}});$(document).mouseup(function(){$("#workspace").data("mousedown",false);$("#workspace").removeData("prev_mouse_cords")});$(".input-number").live("keydown",input_int);$("#worksheet_width, #worksheet_height").blur(recalc_workspace);$(".unit_text").live("mouseenter",function(){if($(this).next().is("select")){switch_display($(this),$(this).next())}});$(".unit").change(function(){if($(this).prev().is("span.unit_text")){$(this).prev().text($(this).val());switch_display($(this),$(this).prev());recalc_workspace()}else{$(this).before($("<span class='unit_text'>"+$(this).val()+"</span>"));switch_display($(this),$(this).prev())}});$(".unit").change();$("#design-reset").click(function(){$(".layer , .component[layer_id]").remove()});$("#design-save").click(function(){var b={global_settings:global_settings};$($(".layer").get().reverse()).each(function(d){var f=$(".component[layer_id='"+$(this).data("layer_id")+"']");var e={layer_name:$(this).text().substr(1),layer_id:$(this).data("layer_id"),component_type:f.data("component_type"),css:{"background-color":f.data("css")["background-color"],color:f.data("css").color,height:f.css("height"),width:f.css("width"),top:f.css("top"),left:f.css("left")}};if(f.data("user_events")){e.user_events=f.data("user_events")}if(f.css("font-size")){e.css["font-size"]=f.css("font-size")}if(f.css("padding")){e.css.padding=f.css("padding")}if(f.data("component_type")=="blog_posts"){e.css["min-height"]=e.css["height"];delete e.css["height"]}if(f.data("component_type")=="text"){e.text=f.text()}if(f.data("component_type")=="image"){if(f.css("background-image")!=undefined){e.image=f.find("img").attr("src")}}if(f.data("component_type")=="list"){var g={};f.find("li").each(function(h){g[h]={url:$(this).find("a").attr("href"),name:$(this).text()}});e.list=g}if(f.data("component_type")=="grid"){var c={};f.children(".component").each(function(h){c[h]=$(this).data("layer_id")});e.grid=c}b[d]=e});$.post("/storage/"+select.blog+"/"+select.layout+window.location.search,{"design-save":JSON.stringify(b)},function(){$("#notice span").text("Sparad!");$("#notice").fadeIn("fast").delay(5000).fadeOut("slow")});return false});$("#design-load").click(function(c,b){var d={};if(b=="example"){d={example:"example"}}$.get("/storage/"+select.blog+"/"+select.layout+window.location.search,d,function(e){if(e==""){e="{}"}load_design_by_json($.parseJSON(e));$("#notice span").text("Inladdad!");$("#notice").fadeIn("fast").delay(5000).fadeOut("slow")});return false});$("#design-preview").click(function(){$("#design-save").click();$(this).ajaxStop(function(){window.location.href=window.location.protocol+"//"+select.blog+"."+window.location.hostname});return false});$("#design-load-example").click(function(){$("#design-reset").click();$("#design-load").trigger("click",["example"]);return false});$("#settings-background").click(function(){$("#dialog-settings-background").dialog({autoOpen:false,modal:true,open:function(){$(this).find("#inner-background").val(global_settings.inner_background);$(this).find("#outer-background").val(global_settings.outer_background)},buttons:{Avbryt:function(){$(this).dialog("close");$(this).dialog("destroy")},"Ändra":function(){global_settings.inner_background=$(this).find("#inner-background").val();global_settings.outer_background=$(this).find("#outer-background").val();$(this).dialog("close");$(this).dialog("destroy")}},close:function(){$(this).find("input[name=url]").val("http://")}});$("#dialog-settings-background").dialog("open")});$(window).bind("resize",init);init();a();initializeComponents();$("#workspace").queue(function(){initializeScroll();$(this).dequeue()});$(".colorpicker_current_color").live("click",function(){$(this).parent().find(".colorpicker_submit").click()})});