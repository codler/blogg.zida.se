function init(){var a={height:$(window).height(),width:$(window).width()};if($("#tool").offset().left+$("#tool").width()>a.width){$("#tool").css({left:a.width-$("#tool").width()})}if(tool_settings.dock){w=200;$("#tool").css({"border-width":"0px",left:a.width-$("#tool").width()})}else{w=0;$("#tool").css({"border-width":"3px"})}$("#tool").css({maxHeight:a.height-$("nav").height()-($("#tool").outerHeight()-$("#tool").innerHeight()),top:$("nav").height()});$("#worksheet").css({height:a.height-$("nav").height(),width:a.width-w,top:$("nav").height()});$("#workspace").css({top:0,left:0});$(".input-number").easyTooltip({content:"Tips: Använd uppåt eller neråt pilen om du ska stega några pixlar!",clickRemove:true});$(".input-number").mousedown(function(){$(this).unbind("mouseenter")});$("#tool-section-layer .draghandler").easyTooltip({content:"Tips: Markera flera lager en i taget (CTRL) eller ett område (SHIFT) för att flytta eller ändra flera objekt samtidigt!",clickRemove:true});recalc_workspace()}function initializeComponents(){$.each(components,function(b,c){var a=c;$("<div/>").attr({id:"component_"+b}).addClass("tool-component").text(a.text).appendTo("#tool-section-component .tool-section-content");$("#component_"+b).easyTooltip({content:a.description});jQuery.data($("#component_"+b).get(0),"component_type",b);jQuery.data($("#component_"+b).get(0),"tool",true)});$(".tool-component").draggable({appendTo:"#worksheet",containment:"#worksheet",distance:50,helper:"clone",opacity:0.7,snap:"#workspace .component",snapMode:"inner"})}function initializeScroll(){measure_workspace();var a={top:$("#workspace").css("top").replace("px",""),left:$("#workspace").css("left").replace("px","")};var c;var b;if(global_settings.worksheet_height>$("#worksheet").height()){c=a.top}else{c=a.top-($("#worksheet").height()-global_settings.worksheet_height)/2}if(global_settings.worksheet_width>$("#worksheet").width()){b=a.left}else{b=a.left-($("#worksheet").width()-global_settings.worksheet_width)/2}$("#worksheet").animate({scrollTop:c,scrollLeft:b})}function hide_focus_frame(a,b){b=b||false;if(!b){$("div[frame_id='"+a.data("layer_id")+"']").remove()}else{$("div[frame_id='"+a.data("layer_id")+"']",b).remove()}}function show_focus_frame(b,c,a){a=a||1;$("<div/>").attr({frame_id:b.data("layer_id")}).css({"background-color":"red",position:"absolute",height:a,width:b.outerWidth(),left:b.position().left,top:b.position().top,zIndex:3000}).appendTo(c);$("<div/>").attr({frame_id:b.data("layer_id")}).css({"background-color":"red",position:"absolute",height:a,width:b.outerWidth(),left:b.position().left,top:b.position().top+b.outerHeight(),zIndex:3000}).appendTo(c);$("<div/>").attr({frame_id:b.data("layer_id")}).css({"background-color":"red",position:"absolute",height:b.outerHeight(),width:a,left:b.position().left,top:b.position().top,zIndex:3000}).appendTo(c);$("<div/>").attr({frame_id:b.data("layer_id")}).css({"background-color":"red",position:"absolute",height:b.outerHeight(),width:a,left:b.position().left+b.outerWidth(),top:b.position().top,zIndex:3000}).appendTo(c)}function measure_workspace(){var a=$("#worksheet_height").val();var b=$("#worksheet_width").val();if($("#worksheet_height").parent().next().children(".unit_text").text()=="%"){a=a/100*$("#worksheet").height()}if($("#worksheet_width").parent().next().children(".unit_text").text()=="%"){b=b/100*$("#worksheet").width()}global_settings.worksheet_height=a;global_settings.worksheet_width=b}function recalc_workspace(){measure_workspace();var a=global_settings.worksheet_height;var d=global_settings.worksheet_width;var e=Math.max(Math.min(a-a/2,500),$("#worksheet").height()/2-a/2);var f=Math.max(Math.min(d-d/2,500),$("#worksheet").width()/2-d/2);var c=$("#workspace").css("top").replace("px","");var b=$("#workspace").css("left").replace("px","");$("#worksheet").animate({scrollTop:$("#worksheet").scrollTop()+(e-c),scrollLeft:$("#worksheet").scrollLeft()+(f-b)},{queue:false});$("#workspace").animate({height:a,width:d,top:Math.max(Math.min(a-a/2,500),$("#worksheet").height()/2-a/2),left:Math.max(Math.min(d-d/2,500),$("#worksheet").width()/2-d/2)}).queue(function(){$("#worksheet-size").css({top:Math.max(a*2,$("#worksheet").height()-25),left:Math.max(d*2,$("#worksheet").width()-25)});$(this).dequeue()})}function load_design_by_json(b){var c={};var a=0;$.each(b,function(e,f){if(e=="global_settings"){$("#worksheet_height").val(f.worksheet_height);$("#worksheet_width").val(f.worksheet_width);$("#inner-background").val(f.inner_background);$("#outer-background").val(f.outer_background);global_settings.inner_background=f.inner_background;global_settings.outer_background=f.outer_background;return}$.each(c,function(g,h){if(f.layer_id==h.old_id){f.layer_id=h.new_id}if(f.user_events){$.each(f.user_events,function(i,j){if(j.layer==h.old_id){j.layer=h.new_id}})}});if($(".layer[layer_id='"+f.layer_id+"']").length>0){var d=Math.floor(Math.random()*9999999)+100000;c[a]={old_id:f.layer_id,new_id:d};f.layer_id=d;a++}$.each(c,function(g,h){if(f.layer_id==h.old_id){f.layer_id=h.new_id}if(f.user_events){$.each(f.user_events,function(i,j){if(j.layer==h.old_id){j.layer=h.new_id}})}});if(f.user_events){$.each(f.user_events,function(h,i){if($(".layer[layer_id='"+i.layer+"']").length>0){var g=Math.floor(Math.random()*9999999)+100000;c[a]={old_id:i.layer,new_id:g};i.layer=g;a++}})}add_component(f.component_type,f)});$.each(b,function(d,e){if(e.component_type=="grid"){if(e.grid&&e.layer_id){$.each(e.grid,function(h,g){var f=$(select.component.id(g));if(f.length>0){f.data("grid",true).css({position:"static",minHeight:10}).resizable("destroy");$(select.component.id(e.layer_id)).append(f)}})}}});recalc_workspace()}function add_component(e,d,g){var d=d||false,g=g||false;if(!d){var c=components[e].css;c.left=g.pageX-$("#workspace").offset().left-tool_settings.component.width/2;c.top=g.pageY-$("#workspace").offset().top-tool_settings.component.height/2;d={component_type:e,layer_name:components[e].text+"-"+(global_settings.component_zIndex-499),css:jQuery.extend(true,{},c)}}var f=$("#component_"+d.component_type).clone(),h=Math.floor(Math.random()*9999999)+100000;if(d.layer_id){h=d.layer_id}f.removeAttr("id").addClass("component_"+d.component_type);f.removeClass("tool-component").addClass("component");if(d.component_type=="blog_posts"){if(d.css["min-height"]){d.css["height"]=(d.css["min-height"]=="auto")?"300px":d.css["min-height"];delete d.css["min-height"]}}f.data("component_type",d.component_type);f.data("layer_id",h);f.data("css",d.css);if(d.user_events){f.data("user_events",d.user_events)}$('<div class="layer"><a>X</a>'+d.layer_name+"</div>").attr("layer_id",h).data("layer_id",h).prependTo("#tool-section-layer .tool-section-content");if(d.component_type=="text"){if(d.text){f.text(d.text)}}if(d.component_type=="image"){if(d.image){var a=$("<img/>");a.load(function(){f.height(this.height);f.width(this.width);$(this).data("height",this.height).data("width",this.width).css({width:"100%",height:"100%"})}).attr("src","http://"+d.image.replace("http://",""));f.html(a)}}if(d.component_type=="list"){if(d.list){f.data("list",d.list);var b="<ul>";$.each(d.list,function(i,j){b+="<li><a href='"+j.url+"'>"+j.name+"</a></li>"});b+="</ul>";f.html(b);f.find("ul").sortable({connectWith:".component ul",placeholder:"ui-state-highlight"})}}if(d.component_type=="grid"){f.html("").droppable({accept:".component",drop:function(j,k){var i=k.draggable;i.data("grid",true).css({position:"static",minHeight:10,height:"auto",width:$(this).width()}).resizable("destroy");$(this).append(i)},greedy:true})}f.attr({layer_id:h}).css(d.css).css({position:"absolute","z-index":global_settings.component_zIndex++}).appendTo($("#workspace")).animate({height:d.css.height,width:d.css.width}).resizable(handle_settings.component.resizable).draggable({cancel:"ul",containment:"#worksheet",snap:true,snapTolerance:10,distance:40,opacity:0.3,zIndex:1500,start:function(){$(this).click()}})};